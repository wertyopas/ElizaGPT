<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eliza ↔ Assistant Chat Demo</title>
  <style>
    body{font-family:Arial,sans-serif;margin:0;padding:0;background:#0f172a;color:#e6eef8}
    header{padding:20px;background:#112236;text-align:center}
    .container{max-width:900px;margin:24px auto;padding:16px}
    .panel{background:#061124;border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(2,6,23,.6)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    input,select,button{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:#081426;color:inherit}
    button{cursor:pointer}
    #log{height:420px;overflow:auto;padding:12px;background:linear-gradient(180deg,#041025,#071726);border-radius:8px;border:1px solid rgba(255,255,255,.02)}
    .msg{margin:8px 0;padding:10px;border-radius:10px;max-width:85%}
    .from-assistant{background:linear-gradient(90deg,#2a60ff22,#2a60ff11);align-self:flex-end}
    .from-eliza{background:linear-gradient(90deg,#28a74522,#28a74511)}
    .meta{font-size:12px;opacity:.7;margin-bottom:6px}
    footer{margin-top:12px;font-size:13px;opacity:.85}
  </style>
</head>
<body>
  <header>
    <h1>Eliza ↔ Assistant Chat Demo</h1>
    <p>Automated conversation between a local assistant and Eliza chatbot.</p>
  </header>
  <main class="container">
    <div class="panel">
      <div class="controls">
        <button id="startBtn">Start</button>
        <button id="pauseBtn">Pause</button>
        <button id="stepBtn">Step</button>
        <button id="clearBtn">Clear</button>
        <label>Delay(ms)<input id="delay" type="number" value="1200" /></label>
      </div>
      <div id="log"></div>
      <footer>Use this page to run a continuous conversation demo.</footer>
    </div>
  </main>
  <script>
    // Simple Eliza chatbot
    const eliza = (function(){
      const reflections = {"am":"are","i":"you","my":"your","you":"me","me":"you"};
      function reflect(fragment){
        return fragment.split(/\s+/).map(w=>reflections[w.toLowerCase()]||w).join(' ');
      }
      const rules = [
        {pattern:/I need (.*)/i, reply:["Why do you need %1?","Would it help you to get %1?"]},
        {pattern:/I can't (.*)/i, reply:["How do you know you can't %1?","Perhaps you could %1 if you tried."]},
        {pattern:/(.*)/i, reply:["Tell me more about that.","Why do you say that %1?"]}
      ];
      return function(input){
        input=input.trim();
        for(const r of rules){
          const m=input.match(r.pattern);
          if(m){
            return r.reply[Math.floor(Math.random()*r.reply.length)].replace(/%1/g,reflect(m[1]||""));
          }
        }
        return "I don't fully understand.";
      }
    })();

    const logEl = document.getElementById('log');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const stepBtn = document.getElementById('stepBtn');
    const clearBtn = document.getElementById('clearBtn');
    const delayInput = document.getElementById('delay');
    let running=false;
    let convo=[];

    function appendMessage(speaker,text){
      convo.push({speaker,text});
      const d=document.createElement('div');
      d.className='msg '+(speaker==='assistant'?'from-assistant':'from-eliza');
      const meta=document.createElement('div');meta.className='meta';meta.textContent=speaker.toUpperCase();
      const t=document.createElement('div');t.textContent=text;
      d.appendChild(meta);d.appendChild(t);logEl.appendChild(d);
      logEl.scrollTop=logEl.scrollHeight;
    }

    function localAssistantReply(){
      const last=(convo.length?convo[convo.length-1].text:'hello');
      const templates=[
        `Interesting: '${last}'\`,
        `Why do you mention '${last}'?`
      ];
      return templates[Math.floor(Math.random()*templates.length)];
    }

    async function singleTurn(){
      const assistantText=localAssistantReply();
      appendMessage('assistant',assistantText);
      await new Promise(r=>setTimeout(r,200));
      const elText=eliza(assistantText);
      appendMessage('eliza',elText);
    }

    async function runLoop(){
      if(running)return;
      running=true;startBtn.disabled=true;pauseBtn.disabled=false;
      while(running){
        await singleTurn();
        const delay=Math.max(200,parseInt(delayInput.value)||1200);
        await new Promise(r=>setTimeout(r,delay));
      }
    }

    startBtn.addEventListener('click',()=>runLoop());
    pauseBtn.addEventListener('click',()=>{running=false;startBtn.disabled=false;pauseBtn.disabled=true;});
    stepBtn.addEventListener('click',()=>singleTurn());
    clearBtn.addEventListener('click',()=>{convo=[];logEl.innerHTML='';});

    pauseBtn.disabled=true;
    appendMessage('assistant','Hello — ready to start?');
    appendMessage('eliza',eliza('Hello'));
  </script>
</body>
</html>
